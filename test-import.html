<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Solutions CRM - Test Import</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
</head>
<body class="bg-gray-100" style="font-family: 'Inter, Noto Sans, sans-serif'">
    <div class="min-h-screen bg-white">
        <!-- Header -->
        <header class="p-6 bg-white border-b">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold" style="color: #0a2240">Lead Lists</h1>
                    <p class="text-sm text-gray-600 mt-1">Test CSV Import Functionality</p>
                </div>
                <div class="flex items-center gap-4">
                    <button
                        id="importBtn"
                        class="flex items-center gap-2 px-4 py-2 text-white rounded-lg hover:opacity-90 transition-opacity"
                        style="background-color: #3dbff2"
                    >
                        <span class="material-symbols-outlined text-base">upload</span>
                        Import CSV
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-6">
            <div class="bg-white rounded-lg border p-6">
                <h2 class="text-xl font-semibold mb-4" style="color: #0a2240">CSV Import Test</h2>
                <p class="text-gray-600 mb-4">Click the "Import CSV" button above to test the functionality.</p>
                
                <div id="status" class="hidden p-4 rounded-lg mb-4">
                    <p id="statusText"></p>
                </div>

                <div id="fileInfo" class="hidden p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-2">File Information:</h3>
                    <p id="fileName" class="text-sm text-blue-700"></p>
                    <p id="fileSize" class="text-sm text-blue-700"></p>
                    <p id="fileType" class="text-sm text-blue-700"></p>
                </div>

                <div id="csvPreview" class="hidden mt-4">
                    <h3 class="font-medium mb-2" style="color: #0a2240">CSV Preview:</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full border border-gray-200">
                            <thead class="bg-gray-50">
                                <tr id="csvHeaders"></tr>
                            </thead>
                            <tbody id="csvRows"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Hidden File Input -->
        <input type="file" id="fileInput" accept=".csv" style="display: none;">
    </div>

    <script>
        const importBtn = document.getElementById('importBtn');
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const statusText = document.getElementById('statusText');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const fileType = document.getElementById('fileType');
        const csvPreview = document.getElementById('csvPreview');
        const csvHeaders = document.getElementById('csvHeaders');
        const csvRows = document.getElementById('csvRows');

        importBtn.addEventListener('click', () => {
            console.log('Import CSV button clicked!');
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            console.log('File selected:', file.name);
            
            // Show file info
            fileName.textContent = `Name: ${file.name}`;
            fileSize.textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
            fileType.textContent = `Type: ${file.type}`;
            fileInfo.classList.remove('hidden');

            // Validate file type
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showStatus('Please select a CSV file.', 'error');
                return;
            }

            // Read and parse CSV
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const csvText = e.target.result;
                    const data = parseCSV(csvText);
                    
                    if (data.length === 0) {
                        showStatus('No data found in CSV file.', 'error');
                        return;
                    }

                    showStatus(`Successfully parsed ${data.length} rows from CSV file.`, 'success');
                    displayCSVPreview(data);
                } catch (error) {
                    showStatus('Error parsing CSV file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        });

        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) return [];
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                
                headers.forEach((header, index) => {
                    row[header.toLowerCase().replace(/\s+/g, '_')] = values[index] || '';
                });
                
                data.push(row);
            }
            
            return data;
        }

        function showStatus(message, type) {
            statusText.textContent = message;
            status.className = `p-4 rounded-lg mb-4 ${type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 'bg-green-50 border border-green-200 text-green-800'}`;
            status.classList.remove('hidden');
        }

        function displayCSVPreview(data) {
            if (data.length === 0) return;

            const headers = Object.keys(data[0]);
            
            // Create header row
            csvHeaders.innerHTML = headers.map(header => 
                `<th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200">${header}</th>`
            ).join('');

            // Create data rows (show first 10 rows)
            csvRows.innerHTML = data.slice(0, 10).map(row => 
                `<tr class="border-b border-gray-200">${headers.map(header => 
                    `<td class="px-4 py-2 text-sm text-gray-900">${row[header] || ''}</td>`
                ).join('')}</tr>`
            ).join('');

            if (data.length > 10) {
                csvRows.innerHTML += `<tr><td colspan="${headers.length}" class="px-4 py-2 text-sm text-gray-500 text-center">... and ${data.length - 10} more rows</td></tr>`;
            }

            csvPreview.classList.remove('hidden');
        }
    </script>
</body>
</html>
